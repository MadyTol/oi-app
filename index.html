<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Oi ‚Äî –µ–¥–∏–Ω–æ–¥—Ä—É–≥</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    /* –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Å—Ç–∏–ª–∏ ‚Äî –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å */
    :root{--blue:#1d7aff;--bg:#f3f3f3;--card:#fff;--muted:#6b7280;}
    body{font-family:Inter, Arial, sans-serif;background:var(--bg);margin:0;padding:40px;display:flex;align-items:flex-start;justify-content:center;min-height:100vh;}
    .card{background:var(--card);width:720px;max-width:95%;border-radius:14px;padding:36px;box-shadow:0 8px 30px rgba(0,0,0,0.08);}
    h1{font-size:32px;margin:0 0 10px 0}
    p.lead{color:var(--muted);margin:8px 0 20px 0}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:18px}
    .city{padding:18px;border-radius:12px;border:1px solid rgba(0,0,0,0.06);background:#fff;cursor:pointer;display:flex;align-items:center;gap:12px;font-weight:600}
    .city.selected{outline:3px solid rgba(29,122,255,0.14);box-shadow:0 6px 20px rgba(29,122,255,0.06)}
    .controls{display:flex;gap:12px;margin-top:20px}
    .btn{padding:12px 18px;border-radius:8px;border:none;cursor:pointer}
    .btn.primary{background:var(--blue);color:#fff;box-shadow:0 6px 18px rgba(29,122,255,0.18)}
    .btn.ghost{background:#fff;border:1px solid rgba(0,0,0,0.08)}
    /* registration form */
    .reg{margin-top:30px}
    .row{display:flex;gap:12px}
    .input{width:100%;padding:12px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:#fff}
    .cats{display:flex;gap:8px;margin:12px 0}
    .cat-btn{padding:8px 12px;border-radius:999px;border:1px solid rgba(0,0,0,0.06);cursor:pointer;background:#fff}
    .cat-btn.active{background:rgba(29,122,255,0.08);border-color:rgba(29,122,255,0.18)}
    #hobbyList{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
    .hobby-item{padding:12px 18px;border-radius:10px;background:#fff;border:1px solid rgba(0,0,0,0.06);cursor:pointer}
    .hobby-item.selected{background:linear-gradient(90deg,#1d7aff,#6fb8ff);color:#fff;border:none;box-shadow:0 6px 14px rgba(29,122,255,0.12)}
    .small{font-size:13px;color:var(--muted)}
    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
    @media (max-width:520px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>

  <div class="card" id="regWrapper">
    <h1>–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</h1>
    <p class="lead">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å. –ú–æ–∂–Ω–æ –∏—Å–∫–∞—Ç—å.</p>

    <input id="citySearch" class="input" placeholder="–ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä –ë–∏—à–∫–µ–∫)" />

    <div style="height:18px"></div>

    <div class="grid" id="cityGrid">
      <!-- –≥–æ—Ä–æ–¥–∞ –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è JS -->
    </div>

    <div class="controls">
      <button id="sendBot" class="btn primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –±–æ—Ç—É</button>
      <button id="saveLocal" class="btn ghost">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ</button>
    </div>

    <!-- —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
    <div class="reg" id="stepForm" style="display:none;">
      <h1 style="font-size:24px;margin-top:18px">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
      <p class="small">–£–∫–∞–∂–∏—Ç–µ –∏–º—è, –≤–æ–∑—Ä–∞—Å—Ç –∏ —Ö–æ–±–±–∏</p>

      <div style="height:12px"></div>
      <input id="inpName" class="input" placeholder="–í–∞—à–µ –∏–º—è" />
      <div style="height:10px"></div>
      <input id="inpAge" class="input" placeholder="–í–æ–∑—Ä–∞—Å—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä 28)" />

      <div style="height:12px"></div>
      <div class="small">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ö–æ–±–±–∏</div>
      <div id="hobbyCategories" class="cats"></div>

      <div id="hobbyList"></div>

      <div style="height:14px"></div>
      <div style="display:flex;gap:8px">
        <button id="backBtn" class="btn ghost">–ù–∞–∑–∞–¥</button>
        <button id="submitRegBtn" class="btn primary">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
      </div>
    </div>

    <footer id="regResult"></footer>
  </div>

<script>
(function(){
  // ---------- –¥–∞–Ω–Ω—ã–µ –≥–æ—Ä–æ–¥–æ–≤ ----------
  const CITIES = [
    {id:'bishkek', title:'–ë–∏—à–∫–µ–∫', flag:'üá∞üá¨'},
    {id:'almaty', title:'–ê–ª–º–∞—Ç—ã', flag:'üá∞üáø'},
    {id:'astana', title:'–ê—Å—Ç–∞–Ω–∞', flag:'üá∞üáø'},
    {id:'moscow', title:'–ú–æ—Å–∫–≤–∞', flag:'üá∑üá∫'},
    {id:'tashkent', title:'–¢–∞—à–∫–µ–Ω—Ç', flag:'üá∫üáø'}
  ];

  // ---------- —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ö–æ–±–±–∏ ----------
  const HOBBIES = {
    "–°–ø–æ—Ä—Ç": [
      "–§—É—Ç–±–æ–ª","–ü–ª–∞–≤–∞–Ω–∏–µ","–ë–∞—Å–∫–µ—Ç–±–æ–ª","–ù–∞—Å—Ç–æ–ª—å–Ω—ã–π —Ç–µ–Ω–Ω–∏—Å","–í–æ–ª–µ–π–±–æ–ª",
      "–ë–µ–≥","–ë–æ–∫—Å","–ö—Ä–æ—Å—Å—Ñ–∏—Ç","–í–µ–ª–æ—Å–∏–ø–µ–¥"
    ],
    "–ò—Å–∫—É—Å—Å—Ç–≤–æ": [
      "–ú—É–∑—ã–∫–∞","–¢–∞–Ω—Ü—ã","–†–∏—Å–æ–≤–∞–Ω–∏–µ","–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è","–ü–µ–Ω–∏–µ","–¢–µ–∞—Ç—Ä"
    ],
    "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏": [
      "–ö–æ–¥–∏–Ω–≥","AI/ChatGPT","–†–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫–∞","3D-–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ","–ì–µ–π–º–¥–µ–≤"
    ],
    "–û–±—â–µ–Ω–∏–µ": [
      "–ö–æ—Ñ–µ-–≤—Å—Ç—Ä–µ—á–∏","–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è","–ù–∞—Å—Ç–æ–ª–∫–∏","–ö–Ω–∏–≥–∏","–Ø–∑—ã–∫–æ–≤–æ–π –∫–ª—É–±"
    ]
  };

  // —ç–ª–µ–º–µ–Ω—Ç—ã
  const cityGrid = document.getElementById('cityGrid');
  const citySearch = document.getElementById('citySearch');
  const sendBot = document.getElementById('sendBot');
  const saveLocal = document.getElementById('saveLocal');
  const stepForm = document.getElementById('stepForm');
  const inpName = document.getElementById('inpName');
  const inpAge = document.getElementById('inpAge');
  const hobbyCategories = document.getElementById('hobbyCategories');
  const hobbyList = document.getElementById('hobbyList');
  const backBtn = document.getElementById('backBtn');
  const submitRegBtn = document.getElementById('submitRegBtn');
  const regResult = document.getElementById('regResult');

  let selectedCity = null;
  let selectedCategory = null;
  let selectedHobbies = new Set();

  // –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –≥–æ—Ä–æ–¥–æ–≤
  function renderCities(filter=''){
    cityGrid.innerHTML = '';
    const f = filter.trim().toLowerCase();
    CITIES.filter(c=>c.title.toLowerCase().includes(f)).forEach(c=>{
      const el = document.createElement('div');
      el.className = 'city';
      el.innerHTML = `<span style="font-size:20px">${c.flag}</span><span>${c.title}</span>`;
      el.onclick = ()=>{
        document.querySelectorAll('.city').forEach(x=>x.classList.remove('selected'));
        el.classList.add('selected');
        selectedCity = c;
      };
      cityGrid.appendChild(el);
    });
  }
  citySearch.addEventListener('input',()=>renderCities(citySearch.value));

  // –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ö–æ–±–±–∏
  function renderCategories(){
    hobbyCategories.innerHTML = '';
    Object.keys(HOBBIES).forEach(cat=>{
      const b = document.createElement('button');
      b.className = 'cat-btn';
      b.textContent = cat;
      b.onclick = ()=>{
        document.querySelectorAll('.cat-btn').forEach(x=>x.classList.remove('active'));
        b.classList.add('active');
        selectedCategory = cat;
        renderHobbyItems(cat);
      };
      hobbyCategories.appendChild(b);
    });
  }

  // —Å–ø–∏—Å–æ–∫ —Ö–æ–±–±–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  function renderHobbyItems(cat){
    hobbyList.innerHTML = '';
    HOBBIES[cat].forEach(h=>{
      const d = document.createElement('div');
      d.className = 'hobby-item' + (selectedHobbies.has(h) ? ' selected' : '');
      d.textContent = h;
      d.onclick = ()=>{
        if(selectedHobbies.has(h)) selectedHobbies.delete(h);
        else selectedHobbies.add(h);
        renderHobbyItems(cat);
      };
      hobbyList.appendChild(d);
    });
  }

  // –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –∫ —Ñ–æ—Ä–º–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –≥–æ—Ä–æ–¥–∞)
  sendBot.addEventListener('click', ()=>{
    if(!selectedCity){ alert('–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥'); return; }
    // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
    stepForm.style.display = 'block';
    // —Å–∫—Ä—ã–≤–∞—Ç—å –º–æ–∂–Ω–æ ‚Äî –Ω–æ —É –Ω–∞—Å –¥–µ–ª–∞–µ–º –ø–æ–∫–∞ inline
    renderCategories();
  });

  saveLocal.addEventListener('click', ()=>{
    if(!selectedCity){ alert('–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥'); return; }
    localStorage.setItem('oi_city', JSON.stringify(selectedCity));
    alert('–ì–æ—Ä–æ–¥ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –ª–æ–∫–∞–ª—å–Ω–æ: ' + selectedCity.title);
  });

  backBtn.addEventListener('click', ()=>{
    stepForm.style.display = 'none';
  });

  submitRegBtn.addEventListener('click', ()=>{
    const name = inpName.value.trim();
    const age = inpAge.value.trim();
    if(!name || !age){ alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ –≤–æ–∑—Ä–∞—Å—Ç'); return; }
    if(selectedHobbies.size === 0){ if(!confirm('–í—ã –Ω–µ –≤—ã–±—Ä–∞–ª–∏ —Ö–æ–±–±–∏. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) return; }

    const payload = {
      city: selectedCity,
      name, age,
      hobbies: Array.from(selectedHobbies)
    };

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
    localStorage.setItem('oi_user', JSON.stringify(payload));
    regResult.innerText = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞ ‚Äî –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ.';
    regResult.style.color = '#0a7a0a';

    // –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram WebApp (–µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç –≤–Ω—É—Ç—Ä–∏ Telegram)
    try {
      if(window.Telegram && Telegram.WebApp){
        const tg = Telegram.WebApp;
        tg.expand();
        // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –Ω—É–∂–Ω—ã–π –º–µ—Ç–æ–¥)
        tg.sendData(JSON.stringify(payload));
      }
    } catch(e){
      console.warn('tg send fail', e);
    }
  });

  // Init
  renderCities();
  renderCategories();

})();
</script>

</body>
</html>
