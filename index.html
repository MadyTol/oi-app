<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Oi ‚Äî –µ–¥–∏–Ω–æ–¥—Ä—É–≥</title>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root{
      --bg:#f3f4f6;
      --card:#ffffff;
      --accent:#1d7aff;
      --muted:#667085;
      --radius:14px;
      --gap:18px;
    }
    html,body{height:100%;margin:0;background:var(--bg);font-family:Inter,Arial,sans-serif;color:#0f1724}
    .wrap{max-width:900px;margin:36px auto;padding:20px}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:0 10px 30px rgba(12,14,20,0.06);padding:28px; text-align:center}
    h1{margin:0 0 8px;font-size:26px;color:#0b1220}
    p.lead{margin:0 0 18px;color:var(--muted)}
    .btn{display:inline-block;background:var(--accent);color:#fff;padding:12px 18px;border-radius:9px;border:none;cursor:pointer;font-weight:600;box-shadow:0 6px 16px rgba(29,122,255,0.18)}
    .btn.ghost{background:transparent;color:var(--accent);box-shadow:none;border:1px solid rgba(29,122,255,0.12)}
    .controls{display:flex;gap:12px;align-items:center;justify-content:center;margin:18px 0 22px;flex-wrap:wrap}
    .search{flex:1;min-width:220px}
    input.search{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #e6e9ef;background:#fff;box-sizing:border-box}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:var(--gap);margin-top:6px}
    .city{background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,1));padding:14px;border-radius:12px;border:1px solid rgba(12,14,20,0.03);cursor:pointer;display:flex;align-items:center;gap:12px;transition:transform .14s ease, box-shadow .14s ease}
    .city:hover{transform:translateY(-6px);box-shadow:0 14px 30px rgba(12,14,20,0.06)}
    .city .flag{font-size:28px}
    .city .name{font-weight:600}
    .city.selected{outline:3px solid rgba(29,122,255,0.12);box-shadow:0 16px 40px rgba(29,122,255,0.06)}
    .footer{display:flex;gap:12px;align-items:center;justify-content:center;margin-top:22px;flex-wrap:wrap}
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:34px;background:#0b1220;color:#fff;padding:10px 16px;border-radius:10px;opacity:0;pointer-events:none;transition:opacity .2s}
    .toast.show{opacity:1;pointer-events:auto}
    .small{font-size:13px;color:var(--muted)}
    @media (max-width:420px){
      .wrap{margin:18px;padding:14px}
      .card{padding:18px}
      .grid{gap:12px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="start-card">
      <h1>Oi <span style="font-size:18px">üëã</span></h1>
      <p class="lead">–ü–æ–∏—Å–∫ –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤ –ø–æ –≥–æ—Ä–æ–¥–∞–º</p>
      <div style="margin-top:14px">
        <button class="btn" id="open-btn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
      </div>
    </div>

    <div class="card" id="select-card" style="display:none; margin-top:18px">
      <h1>–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</h1>
      <p class="small">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å. –ú–æ–∂–Ω–æ –∏—Å–∫–∞—Ç—å.</p>

      <div class="controls" style="margin-top:14px">
        <div class="search">
          <input id="search" class="search" placeholder="–ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä –ë–∏—à–∫–µ–∫)" />
        </div>
        <div>
          <button id="clear" class="btn ghost">–°–±—Ä–æ—Å</button>
        </div>
      </div>

      <div class="grid" id="grid"></div>

      <div class="footer">
        <button id="sendBtn" class="btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –±–æ—Ç—É</button>
        <button id="saveBtn" class="btn ghost">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    // –¢–µ–ª–µ–≥—Ä–∞–º WebApp
    const tg = window.Telegram?.WebApp || null;
    try{ tg && tg.expand && tg.expand(); }catch(e){}

    // –ì–æ—Ä–æ–¥–∞ (—Ñ–ª–∞–≥ - emoji)
    const CITIES = [
      { id: 'bishkek', name: '–ë–∏—à–∫–µ–∫', flag: 'üá∞üá¨' },
      { id: 'almaty', name: '–ê–ª–º–∞—Ç—ã', flag: 'üá∞üáø' },
      { id: 'astana', name: '–ê—Å—Ç–∞–Ω–∞', flag: 'üá∞üáø' },
      { id: 'moscow', name: '–ú–æ—Å–∫–≤–∞', flag: 'üá∑üá∫' },
      { id: 'tashkent', name: '–¢–∞—à–∫–µ–Ω—Ç', flag: 'üá∫üáø' }
    ];

    const grid = document.getElementById('grid');
    const search = document.getElementById('search');
    const openBtn = document.getElementById('open-btn');
    const startCard = document.getElementById('start-card');
    const selectCard = document.getElementById('select-card');
    const toast = document.getElementById('toast');
    const sendBtn = document.getElementById('sendBtn');
    const saveBtn = document.getElementById('saveBtn');
    const clearBtn = document.getElementById('clear');

    let selected = localStorage.getItem('oi_city') || null;

    function showToast(msg, timeout=2200){
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(()=>toast.classList.remove('show'), timeout);
    }

    function renderCities(filter = ''){
      grid.innerHTML = '';
      const q = filter.trim().toLowerCase();
      const visible = CITIES.filter(c => c.name.toLowerCase().includes(q) || c.id.includes(q));
      visible.forEach(city => {
        const node = document.createElement('div');
        node.className = 'city' + (selected === city.id ? ' selected' : '');
        node.dataset.id = city.id;
        node.innerHTML = `<div class="flag">${city.flag}</div><div class="name">${city.name}</div>`;
        node.addEventListener('click', () => {
          selectCity(city.id);
        });
        grid.appendChild(node);
      });
      if(visible.length === 0){
        grid.innerHTML = '<div class="small" style="padding:12px;text-align:center;color:var(--muted)">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
      }
    }

    function selectCity(id){
      selected = id;
      localStorage.setItem('oi_city', id);
      renderCities(search.value);
      const cityObj = CITIES.find(c=>c.id===id);
      showToast('–í—ã –≤—ã–±—Ä–∞–ª–∏: ' + (cityObj?cityObj.name:id));
    }

    function sendToBot(){
      if(!selected){
        showToast('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥');
        return;
      }
      const cityObj = CITIES.find(c=>c.id===selected);
      const payload = JSON.stringify({ action: 'city_selected', city: selected, name: cityObj?.name || selected });
      if(tg && tg.sendData){
        try {
          tg.sendData(payload);
          showToast('–ì–æ—Ä–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –±–æ—Ç—É: ' + (cityObj?.name || selected));
        } catch(e){
          console.error(e);
          showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –±–æ—Ç—É');
        }
      } else {
        // fallback: –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å
        showToast('–î–∞–Ω–Ω—ã–µ –≥–æ—Ç–æ–≤—ã (–ª–æ–∫–∞–ª—å–Ω–æ): ' + (cityObj?.name || selected));
        console.log('Payload to bot:', payload);
      }
    }

    // UI handlers
    openBtn.addEventListener('click', ()=>{
      startCard.style.display = 'none';
      selectCard.style.display = 'block';
      renderCities();
      if(tg && tg.MainButton) tg.MainButton.hide && tg.MainButton.hide();
    });

    search.addEventListener('input', (e)=> renderCities(e.target.value));
    sendBtn.addEventListener('click', sendToBot);
    saveBtn.addEventListener('click', ()=>{
      if(!selected) return showToast('–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ –ø—Ä–µ–∂–¥–µ —á–µ–º —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å');
      showToast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ');
    });
    clearBtn.addEventListener('click', ()=>{
      search.value = '';
      renderCities('');
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    renderCities();

    // –ï—Å–ª–∏ —É–∂–µ –±—ã–ª –≤—ã–±–æ—Ä ‚Äî —Å—Ä–∞–∑—É –æ—Ç–∫—Ä—ã—Ç—å
    if(selected){
      // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –∏ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º
      startCard.style.display = 'none';
      selectCard.style.display = 'block';
      renderCities();
    }

    // Accessibility: Enter on search triggers filter (already handled)
    // End of script
  </script>
</body>
</html>
<!-- BEGIN: –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
<div id="regWrapper" style="display:none; padding:40px; text-align:center; max-width:720px; margin:20px auto;">
  <div id="stepCity" style="display:block;">
    <h2 style="font-size:28px; margin-bottom:8px;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
    <p style="color:#666; margin-bottom:18px;">–í—ã–±—Ä–∞–Ω –≥–æ—Ä–æ–¥: <strong id="selectedCityText"></strong></p>
    <button id="startRegBtn" style="background:#1d7aff;color:#fff;border:none;padding:10px 18px;border-radius:10px;cursor:pointer;">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
  </div>

  <div id="stepForm" style="display:none; text-align:left; margin-top:20px;">
    <label style="display:block; margin-bottom:8px;">–ò–º—è
      <input id="inpName" type="text" placeholder="–í–∞—à–µ –∏–º—è" style="width:100%; padding:10px; margin-top:6px; border-radius:8px; border:1px solid #e3e7ee;">
    </label>

    <label style="display:block; margin-top:12px;">–í–æ–∑—Ä–∞—Å—Ç
      <input id="inpAge" type="number" min="8" max="120" placeholder="–ù–∞–ø—Ä. 28" style="width:150px; padding:10px; margin-top:6px; border-radius:8px; border:1px solid #e3e7ee;">
    </label>

    <div style="margin-top:18px;">
      <div style="font-weight:600; margin-bottom:8px;">–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ–±–±–∏ (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)</div>

      <div id="categories" style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;"></div>

      <div id="hobbyCards" style="display:flex;flex-wrap:wrap;gap:10px;"></div>
    </div>

    <div style="display:flex; gap:10px; margin-top:18px; justify-content:flex-end;">
      <button id="backBtn" style="background:#fff;color:#1d7aff;border:1px solid #1d7aff;padding:10px 14px;border-radius:10px;cursor:pointer;">–ù–∞–∑–∞–¥</button>
      <button id="submitRegBtn" style="background:#1d7aff;color:#fff;border:none;padding:10px 14px;border-radius:10px;cursor:pointer;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    </div>
  </div>

  <div id="regResult" style="display:none; margin-top:18px;">
    <p id="regMsg" style="color:#333;"></p>
    <button id="closeRegBtn" style="background:#fff;color:#1d7aff;border:1px solid #1d7aff;padding:8px 12px;border-radius:8px;cursor:pointer;">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<script>
(function(){

// –ë–æ–ª—å—à–æ–π —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ö–æ–±–±–∏
const HOBBIES = {
    "–°–ø–æ—Ä—Ç": [
        "–§—É—Ç–±–æ–ª","–ü–ª–∞–≤–∞–Ω–∏–µ","–ë–∞—Å–∫–µ—Ç–±–æ–ª","–ù–∞—Å—Ç–æ–ª—å–Ω—ã–π —Ç–µ–Ω–Ω–∏—Å","–í–æ–ª–µ–π–±–æ–ª",
        "–ë–µ–≥","–ë–æ–∫—Å","–ú–ú–ê","–¢—Ö—ç–∫–≤–æ–Ω–¥–æ","–ö—Ä–æ—Å—Å—Ñ–∏—Ç","–í–µ–ª–æ—Å–∏–ø–µ–¥"
    ],
    "–ò—Å–∫—É—Å—Å—Ç–≤–æ": [
        "–ú—É–∑—ã–∫–∞","–¢–∞–Ω—Ü—ã","–†–∏—Å–æ–≤–∞–Ω–∏–µ","–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è","–í–∏–¥–µ–æ—Å—ä—ë–º–∫–∞",
        "–ü–µ–Ω–∏–µ","–ì—Ä–∞—Ñ—Ñ–∏—Ç–∏","–ê–∫—Ç–µ—Ä—Å–∫–æ–µ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ"
    ],
    "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏": [
        "–ö–æ–¥–∏–Ω–≥","AI/ChatGPT","–†–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫–∞","3D-–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ","–ò–≥—Ä—ã/–≥–µ–π–º–¥–µ–≤"
    ],
    "–û–±—â–µ–Ω–∏–µ –∏ –æ—Ç–¥—ã—Ö": [
        "–ö–æ—Ñ–µ-–≤—Å—Ç—Ä–µ—á–∏","–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è","–ù–∞—Å—Ç–æ–ª–∫–∏","–ö–Ω–∏–≥–∏","–Ø–∑—ã–∫–æ–≤—ã–µ –∫–ª—É–±—ã"
    ]
};

const categoryContainer = document.getElementById("hobbyCategories");
const hobbyContainer = document.getElementById("hobbyList");

let selectedCategory = null;
let selectedHobbies = new Set();

// –û—Ç—Ä–∏—Å–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
function renderCategories() {
    categoryContainer.innerHTML = "";
    Object.keys(HOBBIES).forEach(cat => {
        const btn = document.createElement("button");
        btn.className = "cat-btn";
        btn.textContent = cat;
        btn.onclick = () => {
            selectedCategory = cat;
            document.querySelectorAll('.cat-btn')
                .forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            renderHobbies(cat);
        };
        categoryContainer.appendChild(btn);
    });
}

// –û—Ç—Ä–∏—Å–æ–≤–∞—Ç—å —Ö–æ–±–±–∏
function renderHobbies(cat) {
    hobbyContainer.innerHTML = "";
    HOBBIES[cat].forEach(hobby => {
        const div = document.createElement("div");
        div.className = "hobby-item";
        div.textContent = hobby;

        if (selectedHobbies.has(hobby))
            div.classList.add("selected");

        div.onclick = () => {
            if (selectedHobbies.has(hobby))
                selectedHobbies.delete(hobby);
            else
                selectedHobbies.add(hobby);

            renderHobbies(cat);
        };

        hobbyContainer.appendChild(div);
    });
}

renderCategories();

})();
</script>

  const wrapper = document.getElementById('regWrapper');
  const selectedCityText = document.getElementById('selectedCityText');
  const startRegBtn = document.getElementById('startRegBtn');
  const stepCity = document.getElementById('stepCity');
  const stepForm = document.getElementById('stepForm');
  const hobbyCards = document.getElementById('hobbyCards');
  const categories = document.getElementById('categories');
  const inpName = document.getElementById('inpName');
  const inpAge = document.getElementById('inpAge');
  const submitRegBtn = document.getElementById('submitRegBtn');
  const backBtn = document.getElementById('backBtn');
  const regResult = document.getElementById('regResult');
  const regMsg = document.getElementById('regMsg');
  const closeRegBtn = document.getElementById('closeRegBtn');

  function getSelectedCity() {
    return window.selectedCity || localStorage.getItem('oi_city') || null;
  }

  function showWrapperIfCity() {
    const city = getSelectedCity();
    if (!city) return;
    wrapper.style.display = 'block';
    selectedCityText.innerText = city;
  }

  function renderCategories() {
    categories.innerHTML = '';
    Object.keys(HOBBY_CATEGORIES).forEach((cat, idx) => {
      const btn = document.createElement('button');
      btn.innerText = cat;
      btn.style = 'padding:8px 12px;border-radius:8px;border:1px solid #e6eefb;background:#fff;cursor:pointer;';
      btn.dataset.cat = cat;
      btn.onclick = () => {
        Array.from(categories.children).forEach(c=>c.style.borderColor='#e6eefb');
        btn.style.borderColor = '#1d7aff';
        renderHobbies(cat);
      };
      categories.appendChild(btn);
      if (idx === 0) btn.click();
    });
  }

  function renderHobbies(category) {
    hobbyCards.innerHTML = '';
    (HOBBY_CATEGORIES[category]||[]).forEach(h => {
      const card = document.createElement('div');
      card.className = 'hobbyCard';
      card.dataset.id = h.id;
      card.style = 'border:1px solid #ecf0f6;padding:10px 14px;border-radius:10px;cursor:pointer;min-width:140px;text-align:center;background:#fff';
      card.innerText = h.title;
      card.onclick = () => {
        card.classList.toggle('sel');
        if (card.classList.contains('sel')) {
          card.style.background = '#eaf3ff';
          card.style.borderColor = '#1d7aff';
        } else {
          card.style.background = '#fff';
          card.style.borderColor = '#ecf0f6';
        }
      };
      hobbyCards.appendChild(card);
    });
  }

  function getSelectedHobbies() {
    return Array.from(hobbyCards.querySelectorAll('.sel')).map(el => el.dataset.id);
  }

  startRegBtn.onclick = () => {
    stepCity.style.display = 'none';
    stepForm.style.display = 'block';
  };

  backBtn.onclick = () => {
    stepCity.style.display = 'block';
    stepForm.style.display = 'none';
  };

  submitRegBtn.onclick = () => {
    const name = inpName.value.trim();
    const age = parseInt(inpAge.value,10);
    const city = getSelectedCity();
    const hobbies = getSelectedHobbies();

    if (!name) return alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è');
    if (!age || age < 8) return alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç');
    if (!hobbies.length) return alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Ö–æ–±–±–∏');

    const payload = {
      action: 'save_profile',
      city, 
      name,
      age,
      hobbies,
      ts: Date.now()
    };

    if (window.Telegram && Telegram.WebApp && Telegram.WebApp.sendData) {
      Telegram.WebApp.sendData(JSON.stringify(payload));
      regMsg.innerText = '–ì–æ—Ç–æ–≤–æ ‚Äî –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –±–æ—Ç—É.';
    } else {
      localStorage.setItem('oi_profile', JSON.stringify(payload));
      regMsg.innerText = 'WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ.';
    }

    stepForm.style.display = 'none';
    regResult.style.display = 'block';
  };

  closeRegBtn.onclick = () => {
    wrapper.style.display = 'none';
    regResult.style.display = 'none';
  };

  renderCategories();
  showWrapperIfCity();

  window.oi_showRegistration = function(cityName) {
    if (cityName) {
      window.selectedCity = cityName;
      localStorage.setItem('oi_city', cityName);
    }
    selectedCityText.innerText = getSelectedCity();
    wrapper.style.display = 'block';
    stepCity.style.display = 'block';
    stepForm.style.display = 'none';
    regResult.style.display = 'none';
  };
})();
</script><!-- –í–°–¢–ê–í–¨–¢–ï –≠–¢–û –ü–†–Ø–ú–û –í index.html –ø–µ—Ä–µ–¥ </script> -->
<script>
// --- helper: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞ ---
function oi_showRegistration(selectedCity) {
  // –µ—Å–ª–∏ –º–æ–¥–∞–ª—å —É–∂–µ –µ—Å—Ç—å, –æ—Ç–∫—Ä–æ–µ–º –∏ –æ–±–Ω–æ–≤–∏–º –≥–æ—Ä–æ–¥
  let existing = document.getElementById('oi-registration-modal');
  if (!existing) {
    // —Å–æ–∑–¥–∞—ë–º –º–æ–¥–∞–ª—å
    const modal = document.createElement('div');
    modal.id = 'oi-registration-modal';
    Object.assign(modal.style, {
      position: 'fixed', left:0, top:0, right:0, bottom:0,
      display:'flex', alignItems:'center', justifyContent:'center',
      background:'rgba(0,0,0,0.3)', zIndex: 9999,
      padding: '20px',
    });

    modal.innerHTML = `
      <div style="width:100%;max-width:520px;background:#fff;border-radius:12px;padding:28px;box-shadow:0 8px 30px rgba(0,0,0,.12);font-family:Arial,Helvetica,sans-serif;">
        <h2 style="margin:0 0 8px;font-size:28px;text-align:center">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
        <p style="margin:0 0 16px;text-align:center;color:#6b7280">–í—ã –≤—ã–±—Ä–∞–ª–∏ –≥–æ—Ä–æ–¥: <b id="oi-city-name"></b></p>

        <div style="display:flex;gap:8px;margin-bottom:12px;">
          <input id="oi-name" placeholder="–ò–º—è" style="flex:1;padding:12px;border-radius:8px;border:1px solid #e6e6e6;" />
          <input id="oi-age" placeholder="–í–æ–∑—Ä–∞—Å—Ç" type="number" style="width:110px;padding:12px;border-radius:8px;border:1px solid #e6e6e6;" />
        </div>

        <div style="margin-bottom:10px;">
          <label style="display:block;margin-bottom:6px;color:#374151">–£–≤–ª–µ—á–µ–Ω–∏–µ (–≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ)</label>

          <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:8px;">
            <button class="oi-hobby-chip" data-hobby="–§—É—Ç–±–æ–ª" style="padding:10px;border-radius:10px;border:1px solid #e6e6e6;background:#fff;cursor:pointer">‚öΩ –§—É—Ç–±–æ–ª</button>
            <button class="oi-hobby-chip" data-hobby="–ü–ª–∞–≤–∞–Ω–∏–µ" style="padding:10px;border-radius:10px;border:1px solid #e6e6e6;background:#fff;cursor:pointer">üèä –ü–ª–∞–≤–∞–Ω–∏–µ</button>
            <button class="oi-hobby-chip" data-hobby="–ù–∞—Å—Ç–æ–ª—å–Ω—ã–π —Ç–µ–Ω–Ω–∏—Å" style="padding:10px;border-radius:10px;border:1px solid #e6e6e6;background:#fff;cursor:pointer">üèì –ù–∞—Å—Ç. —Ç–µ–Ω–Ω–∏—Å</button>
            <button class="oi-hobby-chip" data-hobby="–ë–∞—Å–∫–µ—Ç–±–æ–ª" style="padding:10px;border-radius:10px;border:1px solid #e6e6e6;background:#fff;cursor:pointer">üèÄ –ë–∞—Å–∫–µ—Ç–±–æ–ª</button>
            <button class="oi-hobby-chip" data-hobby="–í–æ–ª–µ–π–±–æ–ª" style="padding:10px;border-radius:10px;border:1px solid #e6e6e6;background:#fff;cursor:pointer">üèê –í–æ–ª–µ–π–±–æ–ª</button>
            <button class="oi-hobby-chip" data-hobby="–ú—É–∑—ã–∫–∞" style="padding:10px;border-radius:10px;border:1px solid #e6e6e6;background:#fff;cursor:pointer">üéµ –ú—É–∑—ã–∫–∞</button>
            <button class="oi-hobby-chip" data-hobby="–¢–∞–Ω—Ü—ã" style="padding:10px;border-radius:10px;border:1px solid #e6e6e6;background:#fff;cursor:pointer">üíÉ –¢–∞–Ω—Ü—ã</button>
            <button class="oi-hobby-chip" data-hobby="–î—Ä—É–≥–æ–µ" style="padding:10px;border-radius:10px;border:1px solid #e6e6e6;background:#fff;cursor:pointer">‚ú® –î—Ä—É–≥–æ–µ</button>
          </div>
        </div>

        <div style="display:flex;gap:8px;justify-content:center;margin-top:12px;">
          <button id="oi-send-bot" style="background:#1d7aff;color:#fff;padding:12px 18px;border-radius:10px;border:none;cursor:pointer">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –±–æ—Ç—É</button>
          <button id="oi-save-local" style="background:#fff;color:#111;padding:12px 18px;border-radius:10px;border:1px solid #e6e6e6;cursor:pointer">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ</button>
          <button id="oi-close" style="background:transparent;color:#6b7280;padding:12px 10px;border-radius:10px;border:none;cursor:pointer">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        <p id="oi-status" style="text-align:center;color:#6b7280;margin-top:12px;font-size:13px"></p>
      </div>
    `;
    document.body.appendChild(modal);

    // –ø—Ä–∏–≤—è–∑–∫–∏
    document.getElementById('oi-close').onclick = () => modal.remove();
    document.getElementById('oi-save-local').onclick = () => {
      const data = collectOiForm();
      localStorage.setItem('oi-reg-'+(data.city||'?'), JSON.stringify(data));
      showOiStatus('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ ‚úîÔ∏è');
    };
    document.getElementById('oi-send-bot').onclick = () => {
      const data = collectOiForm();
      // –µ—Å–ª–∏ Telegram.WebApp –¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –±–æ—Ç
      if (window.Telegram && window.Telegram.WebApp && typeof window.Telegram.WebApp.sendData === 'function') {
        try {
          window.Telegram.WebApp.sendData(JSON.stringify({type:'registration', payload:data}));
          showOiStatus('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –±–æ—Ç—É ‚úîÔ∏è');
        } catch (err) {
          console.error(err);
          showOiStatus('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –±–æ—Ç—É');
        }
      } else if (window.Telegram && window.Telegram.WebApp && typeof window.Telegram.WebApp.onEvent === 'function') {
        // fallback: –µ—Å–ª–∏ —Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ - –∏—Å–ø–æ–ª—å–∑—É–µ–º sendData –ø–æ –∏–º–µ–Ω–∏
        try {
          window.Telegram.WebApp.sendData(JSON.stringify({type:'registration', payload:data}));
          showOiStatus('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –±–æ—Ç—É ‚úîÔ∏è');
        } catch(e){
          console.log(e);
          showOiStatus('–ù–µ–ª—å–∑—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å: WebApp –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
        }
      } else {
        // –Ω–µ –≤ —Ç–µ–ª–µ–≥–µ ‚Äî –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏–º –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º
        console.log('Registration payload:', data);
        showOiStatus('WebApp –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Äî –¥–∞–Ω–Ω—ã–µ –≤ –∫–æ–Ω—Å–æ–ª–∏');
      }
    };

    // –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —á–∏–ø–æ–≤
    modal.querySelectorAll('.oi-hobby-chip').forEach(chip=>{
      chip.onclick = () => {
        chip.classList.toggle('oi-selected');
        chip.style.background = chip.classList.contains('oi-selected') ? '#1d7aff' : '#fff';
        chip.style.color = chip.classList.contains('oi-selected') ? '#fff' : '#111';
      };
    });

    // collect + helpers
    function collectOiForm(){
      const name = document.getElementById('oi-name').value.trim();
      const age = document.getElementById('oi-age').value;
      const hobbies = Array.from(modal.querySelectorAll('.oi-hobby-chip.oi-selected')).map(n=>n.dataset.hobby);
      const city = modal.querySelector('#oi-city-name').innerText;
      return {city, name, age, hobbies, ts: new Date().toISOString()};
    }
    function showOiStatus(txt){
      const s = modal.querySelector('#oi-status');
      s.innerText = txt;
      setTimeout(()=>{ s.innerText = ''; }, 3000);
    }
  } // end create modal

  // –æ–±–Ω–æ–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≥–æ—Ä–æ–¥ –≤ –º–æ–¥–∞–ª–∏ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
  const modalNow = document.getElementById('oi-registration-modal');
  if (modalNow) {
    modalNow.querySelector('#oi-city-name').innerText = selectedCity || '‚Äî';
    modalNow.style.display = 'flex';
  }
}

// --- –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–≤—è–∑—ã–≤–∞–Ω–∏–µ –∫ –∫–∞—Ä—Ç–æ—á–∫–∞–º –≥–æ—Ä–æ–¥–æ–≤ ---
// –ï—Å–ª–∏ –≤ —Ä–∞–∑–º–µ—Ç–∫–µ —É –∫–∞—Ä—Ç–æ—á–µ–∫ —Å—Ç–æ–∏—Ç –∫–ª–∞—Å—Å .city-card, –∫–æ–¥ —Å–∞–º –ø–æ–≤–µ—Å–∏—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫.
// –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ HTML —É –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ –µ—Å—Ç—å –∞—Ç—Ä–∏–±—É—Ç data-city, –Ω–∞–ø—Ä–∏–º–µ—Ä:
// <div class="city-card" data-city="–ë–∏—à–∫–µ–∫">–ë–∏—à–∫–µ–∫</div>
function oi_bindCityClicks() {
  const cards = document.querySelectorAll('.city-card');
  if (cards.length === 0) {
    // –µ—Å–ª–∏ —Ä–∞–∑–º–µ—Ç–∫–∞ –¥—Ä—É–≥–∞—è ‚Äî –º–æ–∂–Ω–æ –ø–æ–π–º–∞—Ç—å –ø–æ —Ç–µ–∫—Å—Ç—É –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ (backup)
    const possible = Array.from(document.querySelectorAll('button,div')).filter(el=>{
      const txt = (el.innerText||'').trim();
      return ['–ë–∏—à–∫–µ–∫','–ê–ª–º–∞—Ç—ã','–ê—Å—Ç–∞–Ω–∞','–ú–æ—Å–∫–≤–∞','–¢–∞—à–∫–µ–Ω—Ç'].includes(txt);
    });
    possible.forEach(el=>{
      el.classList.add('city-card'); // –ø–æ–º–µ—Ç–∏–º
    });
  }

  document.querySelectorAll('.city-card').forEach(card=>{
    // –µ—Å–ª–∏ data-city –Ω–µ –∑–∞–¥–∞–Ω ‚Äî –±–µ—Ä–µ–º —Ç–µ–∫—Å—Ç
    const cityName = card.dataset.city || (card.innerText || '').trim();
    // –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Ñ–æ–∫—É—Å –ø—Ä–∏ –≤—ã–±–æ—Ä–µ
    card.style.cursor = 'pointer';
    card.addEventListener('click', () => {
      // —Å–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ —É –≤—Å–µ—Ö
      document.querySelectorAll('.city-card').forEach(c=>c.style.boxShadow='none');
      // –≤—ã–¥–µ–ª–∏—Ç—å —Ç–µ–∫—É—â—É—é
      card.style.boxShadow = '0 0 0 4px rgba(29,122,255,0.12)';
      // –≤—ã–∑–≤–∞—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
      oi_showRegistration(cityName);
    });
  });
}

// –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–≤—è–∑–∫—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', oi_bindCityClicks);
} else {
  oi_bindCityClicks();
}
</script>
<!-- END: –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
